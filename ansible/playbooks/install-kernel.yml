---
- hosts: all
  vars_files:
    - vars.yml
  vars:
# derived vars (no need to edit)
    - kernel_rpm: "kernel-{{ rpm_kernel_name }}.x86_64.rpm"
    - kernel_devel_rpm: "kernel-devel-{{ rpm_kernel_name }}.x86_64.rpm"
    - kernel_headers_rpm: "kernel-headers-{{ rpm_kernel_name }}.x86_64.rpm"
    - eve_kernel_workdir: "{{ main_workdir }}/kernel"


  tasks:

    - name: Check whether we've installed the kernel already
      register: kernel_pre_installed
      shell: "ls /boot | grep {{ eve_kernel_compiled_name }} > /dev/null"
      ignore_errors: true

    - when: kernel_pre_installed is succeeded and not force_kernel_install
      debug:
        msg: "Kernel is already installed, skipping. To force install, set force_kernel_install variable to true."

    - when: kernel_pre_installed is succeeded and force_kernel_install
      debug:
        msg: "Kernel is already installed, but force_kernel_install is set. Attempting install"

    - name: Install chromium fork of linux kernel
      when: kernel_pre_installed is failed or force_kernel_install
      include_tasks: "kernel-tasks-{{ kernel_install_type }}.yml"

